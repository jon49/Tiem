var b=bilby,t=b.environment(),f=function(t){var e=t.split("->");return 1===e.length?new Function("x","return ("+e[0].trim()+")"):new Function(e[0].trim(),"return ("+e[1].trim()+")")},stringSize=function(t,e){"use strict";if(!_.isNumber(e))throw new Error("stringSize : Not a number!");return String(t).trim().slice(0,e)},isWholeNumber=function(t){"use strict";return _.isNumber(t)&&t>-1&&Math.floor(t)===t?!0:!1},isBetween=function(t,e,n){"use strict";return n>=t&&e>=n?!0:!1},areUnique=function(t,e){"use strict";if(_.isEmpty(t))return!1;var n=_.map(t,e);return _.isEqual(_.uniq(n).length,t.length)},areUniqueValues=function(t){return _.partialRight(areUnique,t)},toFlatArray=_.compose(_.flatten,_.toArray),complement=function(t){return function(){return!t.apply(null,_.toArray(arguments))}},addRollingArray=function(t,e,n,o){var r=Math.floor;return _.map(t,function(t,i){var a=r(e)===i,s=r(e)===r(n)&&a,u=r(e)<=i&&i<=r(n),c=r(n)===i;return s?o*(n-e)+t:u?a?o*(1+i-e)+t:c?o*(n-i)+t:o+t:t})},fractionalHours=function(t){return t.getHours()+(t.getMinutes()+t.getSeconds()/60)/60},isLikeNumber=function(t){return!isNaN(parseFloat(t))&&isFinite(t)},sum=function(t){return _.reduce(t,function(t,e){return t+(isLikeNumber(e)?+e:0)})},createObject=_.curry(function(t,e){return _.zipObject([t],[e])}),zipObjectT=_.curry(function(t,e,n){return _.zipObject(_.map(n,t),_.map(n,e))}),constants=zipObjectT(_.first,_.compose(_.constant,_.last)),have=_.compose(_.all,_.partialRight(_.map,function(t){return _.has(_.first(t),_.last(t))})),hasAll=_.curry(function(t,e){var n=_.curry(_.has);return _.every(t,n(e))}),isEqual=_.curry(_.isEqual,2),singleTagged=function(t){return b.curry(b.tagged(t.replace(/^(.){1}/,"$1".toUpperCase()),[t]))},zipOverObject=_.curry(function(t,e){var n=_.cloneDeep(t);return o2=_.cloneDeep(e),a1=_.keys(n),a2=_.keys(o2),diff=_.difference(a2,a1),inter=_.intersection(a1,a2),c1=_.cloneDeep(n),_.forEach(diff,function(t){c1[t]=o2[t]}),_.forEach(inter,function(t){c1[t]=_.isArray(c1[t])?c1[t]:[c1[t]],c1[t]=c1[t].concat(o2[t])}),c1}),zipOverObjects=_.partialRight(_.reduce,function(t,e){return zipOverObject(t,e)}),isSomething=complement(_.isEmpty),isSomeString=function(t){return isSomething(t)&&_.isString(t)},map=function(t){return _.partialRight(_.map,t)},not=complement(_.identity),hasDeep=b.flip(_.compose(not,_.isEmpty,_.curry(_.findKey,2))),concat=_.curry(function(t,e){return _.isArray(t)?t.concat(e):e.concat(t)}),invokeNow=function(t,e,n){var o="function"==typeof t;return func=o?t:null!=e&&e[t],args_=_.isArray(n)?n:[],func?func.apply(e,args_):void 0},invoke=_.curry(invokeNow,2),isArrayOf=_.curry(function(t,e){return _.isArray(e)&&_.all(e,t)});t=t.property("stringSize",stringSize).property("isWholeNumber",isWholeNumber).property("isBetween",isBetween).property("areUnique",areUnique).property("areUniqueValues",areUniqueValues).property("toFlatArray",toFlatArray).property("complement",complement).property("addRollingArray",addRollingArray).property("fractionalHours",fractionalHours).property("isLikeNumber",isLikeNumber).property("sum",sum).property("zipObjectT",zipObjectT).property("constants",constants).property("have",have).property("hasAll",hasAll).property("isEqual",isEqual).property("createObject",createObject).method("singleTagged",isSomeString,singleTagged).method("zipOverObject",function(t,e){return _.isPlainObject(t)&&_.isPlainObject(e)},zipOverObject).method("zipOverObjects",_.isArray,zipOverObjects).property("isSomething",isSomething).property("isSomeString",isSomeString).method("not",_.isBoolean,not).property("hasDeep",hasDeep).property("invoke",invoke).property("isArrayOf",isArrayOf);var makeLenses=_.compose(zipObjectT(_.identity,b.objectLens),_.unique),getNow=function(t,e){return t.run(e||this).getter},get=_.curry(getNow),setNow=function(t,e,n){var o=t.run(e).setter(n);return _.isEqual(o.__proto__,e.__proto__)?o:(o.__proto__=e.__proto__,o)},set=_.curry(setNow),toOption=function(t){var e=t||this;return _.isEmpty(e)||_.isEqual(e.self,window)?b.none:b.some(e)},filterByLensNow=function(t,e,n){var o=n||this;return toOption(_.first(_.filter(o,function(n){return _.isEqual(get(t,n),e)})))},xAddToList=function(t,e,n){var o=n||this;return e.fold(function(e){var n=isEqual(get(t,e));return _.reject(o,function(e){return n(get(t,e))}).concat(e)},o)},overNow=function(t,e,n){var o=n||this;return set(t,o,e.call(null,t.run(o).getter))},over=_.curry(overNow),k=constants([["id"],["singleDay"],["in"],["out"],["state","clockState"],["day"],["jobList"],["clockedState"],["name"],["clocked"],["comment"],["total"],["jobActive"],["jobs"],["jobPlaceHolder","Add Job"],["stampsIn","stamps-in"],["stampsOut","stamps-out"]]);t=t.property("k",k);var jobSettingKeys=[k.id(),k.name(),k.jobActive()],clockInKeys=[k.in()],clockOutKeys=[k.out()],jobKeys=[k.id(),k.name(),k.comment(),k.singleDay(),k.total(),k.state()],listObjects=["list"],L=makeLenses(_.union(jobSettingKeys,clockInKeys,clockOutKeys,jobKeys,listObjects,[k.jobs(),"jobSettings"]));t=t.property("L",L);var JobSetting=b.tagged("JobSetting",jobSettingKeys),ClockedIn=b.tagged("ClockedIn",clockInKeys),ClockedOut=b.tagged("ClockedOut",clockOutKeys),Job=b.tagged("Job",jobKeys),JobSettings=b.tagged("JobSettings",listObjects),Jobs=b.tagged("Jobs",listObjects),getJobByNow=function(t,e,n){var o=get(L.list,n||this);return filterByLensNow(t,e,o)},getJobBy=_.curry(getJobByNow,2),xAddJob=function(t,e){return xAddToList(L.id,t,getNow(L.list,e||this))},replaceList=function(t,e,n){var o=n||this;return o.list=t.call(get(L.list,o),e),o},validJobId=function(t,e){var n=parseInt(e);return isNaN(n)?b.failure(["ID is not a number"]):_.any(t,b.singleton(k.id(),n))?b.success(n):b.failure(["No ID number exists"])},validJobName=function(t,e){var n=t.trim(),o=isEqual(n.toLowerCase());return _.isEmpty(n)?b.failure(["Job name must contain characters"]):_.any(_.pluck(e,"name"),_.compose(o,invoke("toLowerCase")))?b.failure(["Job name already exists"]):b.success(n)},validateSingle=function(t,e){var n=b.curry(b.tagged(t.replace(/^(.){1}/,"$1".toUpperCase()),[t]));return b.Do()(b.Do()(n>e))},validJobName_=function(t,e){var n=get(L.list,e||this);return validateSingle(k.name(),validJobName(t,n))},validId=function(t,e){var n=e||this,o=get(L.list,n);return validateSingle(k.id(),validJobId(o,t))},change=_.curry(function(t,e,n){return n.map(function(n){return set(t,n,e)})}),isClockedIn=hasDeep("in"),clockOut=function(t,e){var n=fractionalHours(get(L.in.compose(L.clockState),t)),o=fractionalHours(e),r=addRollingArray(get(L.singleDay,t),n,o,1);return _.reduce([[L.clockState,ClockedOut(e)],[L.singleDay,r],[L.total,sum(r)]],function(t,e){set(_.first(e),t,_.last(e));return set(_.first(e),t,_.last(e))},t)},updateDate=function(t,e){var n=e||this,o=n.map(function(e){return isClockedIn(e)?clockOut(e,t):set(L.clockState,e,ClockedIn(t))});return o},isCreateJobSetting=function(t,e,n){return isWholeNumber(t)&&_.isString(e)&&_.isBoolean(n)},isCreateJob=function(t,e,n,o,r,i){return isWholeNumber(e)&&_.isString(n)&&b.isOption(o)&&o.fold(function(t){return _.isArray(t)&&24===t.length},function(){return!0})&&(_.isEqual(r,k.in())||_.isEqual(r,k.out()))&&_.isDate(i)&&b.isInstanceOf(JobSettings,t)},createJob=function(e,n,o,r,i,a){var s=_.find(e.list,_.compose(isEqual(n),_.partial(getNow,L.id)));if(_.isEmpty(s))return b.error("A new job must be created in the job settings first!");var u=r.getOrElse(_.range(24).map(function(){return 0})),c=_.isEqual(i,k.out())?ClockedOut(a):ClockedIn(a);return Job(n,s[k.name()],o,u,t.sum(u),c)},toObject=function(t){return(t||this).getOrElse({})},isOptionOf=_.curry(function(t,e){b.isOption(e),e.fold(function(e){return b.isInstanceOf(t,e)},!1),e.fold(b.isInstanceOf(t),!1),e.isNone;return b.isOption(e)&&(e.fold(b.isInstanceOf(t),!1)||e.isNone)});t=t.property("JobSetting",b.environment().method("create",isCreateJobSetting,_.compose(toOption,JobSetting)).method("create",b.isInstanceOf(JobSetting),toOption).property("newId",f("(new Date()).getTime()")).method("update",_.isString,change(L.name)).method("update",_.isBoolean,change(L.jobActive)).method("toObject",b.isOption,toObject)),t=t.property("Job",b.environment().method("create",isCreateJob,_.compose(toOption,createJob)).method("update",_.isString,change(L.comment)).method("update",_.isDate,updateDate).method("toObject",b.isOption,toObject)),t=t.property("JobSettings",b.environment().method("create",isArrayOf(b.isInstanceOf(JobSetting)),JobSettings).method("valid",_.isNumber,validId).method("valid",_.isString,validJobName_).method("update",isOptionOf(JobSetting),function(t){return JobSettings(xAddJob(t,this))}).method("get",isWholeNumber,getJobBy(L.id)).method("get",_.isString,getJobBy(L.name)).property("toArray",_.partial(getNow,L.list))),t=t.property("Jobs",b.environment().method("create",isArrayOf(b.isInstanceOf(Job)),Jobs).method("update",isOptionOf(Job),function(t){return Jobs(xAddJob(t,this))}).method("get",isWholeNumber,getJobBy(L.id)).property("toArray",_.partial(getNow,L.list)));var extendObject=function(t,e){_(e).forIn(function(e,n){t.prototype[n]=e})};extendObject(JobSettings,t.JobSettings),extendObject(Jobs,t.Jobs);var Controller=function(){this.date=new Date,this.jobSettings=t.JobSettings.create([toObject(t.JobSetting.create(0,"My Job",!0)),toObject(t.JobSetting.create(1,"My cool job",!0))]),this.jobs=t.Jobs.create([]),this.settings={inColor:"DarkSeaGreen",outColor:"FireBrick",inTextColor:"black",outTextColor:"white"}};Controller.prototype.update=function(t){return _.extend(this,t)};var fadeIn=function(t,e){e||$(t).delay(250).fadeIn(1e3)},fadeOut=function(t,e){e||$(t).delay(250).fadeOut(1e3)},$tm=void 0,define$tm=function(t,e){e||($tm=$(t))},moveE=function(t,e){if(!e){var n=$(t),o=29,r=57,i=28,a=18;$tm.delay(2e3).animate({left:r-o-(i-a)},1e3),n.delay(2e3).animate({left:o-r},1e3)}},createNewJob=function(e){return confirm('Create a new job with name: "'+e+'"?')?t.JobSetting.create(t.JobSetting.newId(),e,!0):b.none},addJob=function(e,n){var o=get(L.jobSettings,e),r=o.valid(n).cata({success:function(t){return _.has(t,k.id())?o.get(get(L.id,t)):createNewJob(get(L.name,t))},failure:function(){return b.none}});r.map(function(n){var r=o.update(t.JobSetting.create(n)),i=get(L.jobs,e).update(t.Job.create(r,n.id,"",b.none,k.in(),new Date));e.update(_.zipObject(["jobs","jobSettings"],[i,r]))})},toggleButton=_.curry(function(e){var n=this;jobs=get(L.jobs,n),job=t.Job.update(new Date,jobs.get(e)),n.update(b.singleton("jobs",jobs.update(job)))}),selectize_={};selectize_.config=function(t){return function(e,n){var o=$(e);if(!n)var r=_.reject(t.jobSettings.toArray(),function(e){return _.contains(t.jobs.toArray(),e.name)}),i={persist:!1,selectOnTab:!1,maxItems:1,create:!0,hideSelected:!0,options:r,labelField:k.name(),valueField:k.id(),searchField:k.name(),sortField:k.name(),borderColor:t.settings.inColor,onChange:function(e){m.startComputation(),_.isEmpty(e)||(addJob(t,isLikeNumber(e)?parseInt(e):e),s.removeOption(e),s.refreshItems(),s.showInput()),m.endComputation()}},a=o.selectize(i),s=a[0].selectize}},function(){"use strict";var t=function(t,e){return t+": "+e+";"},e=function(e){return m("style",[".stamps-in button, .inBackgroundColor {",t("background-color",e.inColor),t("color",e.inTextColor),"}",".stamps-out button {",t("background-color",e.outColor),t("color",e.outTextColor),"}",".inColor {color: ",e.inColor,";}",".selectize-input {border-color: ",e.inColor,";}"].join(""))},n=function(t){return m("header.pure-g",[m("h1.title.pure-u-1-2.inColor",[m("#ti","Ti"),m("#t-m",{config:define$tm},"m"),m("#t-e",{config:moveE},"e"),m("div",{config:fadeOut},"card")]),m(".stamp.date.pure-u-1-2",[m("button.pure-button.options.inBackgroundColor",[m("i.fa.fa-gear")]),m("button.pure-button.inBackgroundColor",t.date.toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"}))])])},o=function(t){return m("#jobs",[m("select",{placeholder:"Enter job name",config:selectize_.config(t)})])},r=_.curry(function(t,e,n){var o=t?{display:"none"}:{},r=t?fadeIn:{},i=e.clockState[isClockedIn(e)?k.in():k.out()];return m(".stamp.pure-g",{id:e.id,style:o,config:r},[m("button.pure-button.pure-u-14-24.jobButton",{title:e.name,onclick:toggleButton.bind(n,e.id)},e.name),m("button.pure-button.pure-u-5-24.time",{title:i},i.toLocaleTimeString()),m("button.pure-button.pure-u-3-24.hours",e.total.toFixed(2)),m("button.pure-button.pure-u-2-24.notes",{title:e.comment},[m("i.fa.fa-pencil")]),m("button.pure-button.pure-u-1-1.text-left.wrap-word.hidden.comment",e.comment)])}),i=r(!0),a=r(!1),s=_.curry(function(t,e){var n=e.jobs,o=n.toArray(),r=isEqual(_.last(o)),s=_.isEqual(t,".stamps-in")?isClockedIn:_.compose(not,isClockedIn);return m(t,_(o).filter(s).sortBy(_.compose(invoke("toLowerCase"),get(L.name))).map(function(t){return(r(get(L.id,t))?i:a)(t,e)}).value())}),u=s(".stamps-in"),c=s(".stamps-out"),l=function(t){return[e(t.settings),n(t),o(t),u(t),c(t)]};m.module(document.body,{view:l,controller:Controller})}();